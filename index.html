
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Antalya Serik Abdurrahmanlar ASM İlaç Takip Sistemi</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f7f9fc; }
    h2 { color: #145A32; }
    input { margin-bottom: 15px; padding: 8px; width: 320px; font-size: 16px; }
    table { width: 100%; border-collapse: collapse; background-color: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #D4EFDF; }
    tr:hover { background-color: #f1f9ff; }
    mark { background-color: yellow; font-weight: bold; }
    .note { margin-bottom: 20px; font-size: 15px; background-color: #e9f5e9; padding: 10px; border-left: 4px solid #28B463; }
  </style>
</head>
<body>

  <h2>Antalya Serik Abdurrahmanlar ASM İlaç Takip Sistemi</h2>
  <div class="note">
    NOT 2:VERİ TABANINDAKİ İLAÇLAR İHTİYAÇ SAHİPLERİNE VE GEREKEN HASTALARA  DOĞRU VE GÜVENİLİR BİÇİMDE İLETİLİP BU SAYEDE İLAÇ İSRAFININ ÖNÜNE GEÇİLMESİ PLANLANMAKTADIR.<br>NOT 3:BU İLAÇLAR SATILIK VEYA MADDİ KARŞILIKLI DEĞİLDİR.UYGUN HASTA GRUBUNA VERİLECEK OLUP KÖTÜYE KULLANIMIN ÖNÜNE GEÇİLMESİ İÇİN SAĞLIK PROFESYONELİ/ECZACI KOORDİNASYONU İLE KARAR VERİLECEKTİR.<br>Abdurrahmanlar Aile Sağlığı Merkezi İlaç Takip Sistemi
  </div>
  <input type="text" id="searchInput" placeholder="İlaç adı ya da etken madde yazınız...">

  <table id="medicineTable">
    <thead>
      <tr>
        <th>Son Kullanım Tarihi</th>
        <th>İlaç Adı ve Dozajı</th>
        <th>Etken Madde</th>
        <th>Stok Adedi</th>
        <th>Grup</th>
        <th>KÜB/KT Linki</th>
      </tr>
    </thead>
    <tbody>
  <table>
    <tr>
        <td>Son kullanım tarihi</td>
        <td>İlaç Adı/doz</td>
        <td>Etken madde/doz</td>
        <td>Stok adedi</td>
        <td>Grup</td>
        <td>küb/kt</td>
        <td>Verilen hasta ve tarih</td>
    </tr>
    <tr>
        <td>06/2026</td>
        <td>BRONKOLIN 300 RETARD TABLET</td>
        <td>TEOFİLİN</td>
        <td>1</td>
        <td>ASTIM/KOAH</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/102c251198748.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>09/2026</td>
        <td>BRONKOLIN 300 RETARD TABLET</td>
        <td>TEOFİLİN</td>
        <td>1</td>
        <td>ASTIM/KOAH</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/102c251198748.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>12/2026</td>
        <td>BRONKOLIN 300 RETARD TABLET</td>
        <td>TEOFİLİN</td>
        <td>2</td>
        <td>ASTIM/KOAH</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/102c251198748.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>02/2027</td>
        <td>BRONKOLIN 300 RETARD TABLET</td>
        <td>TEOFİLİN</td>
        <td>1</td>
        <td>ASTIM/KOAH</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/102c251198748.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>09/2027</td>
        <td>BRONKOLIN 300 RETARD TABLET</td>
        <td>TEOFİLİN</td>
        <td>2</td>
        <td>ASTIM/KOAH</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/102c251198748.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>06/2026</td>
        <td>LİPANTHYL 267 MG SERT KAPSÜL</td>
        <td>FENOFİBRAT</td>
        <td>3</td>
        <td>HİPERLİPİDEMİ</td>
        <td>https://titck.gov.tr/storage/Archive/2021/kubKtAttachments/LPANTHYL267MGSERTKAPSLKB_a68b6754-3680-473c-b09c-96772d02b9ac.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>09/2028</td>
        <td>GLİFOR 1000 MG FİLM TABLET</td>
        <td>METFORMİN HİDROKLORÜR</td>
        <td>2</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/dJZO1IGfwwHJz.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>01/2028</td>
        <td>GLİFOR 1000 MG FİLM TABLET</td>
        <td>METFORMİN HİDROKLORÜR</td>
        <td>2</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/dJZO1IGfwwHJz.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>8/2027</td>
        <td>GLİFOR 1000 MG FİLM TABLET</td>
        <td>METFORMİN HİDROKLORÜR</td>
        <td>1</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/dJZO1IGfwwHJz.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>3/2027</td>
        <td>GLİFOR 1000 MG FİLM TABLET</td>
        <td>METFORMİN HİDROKLORÜR</td>
        <td>1</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/dJZO1IGfwwHJz.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>11/2027</td>
        <td>TEGLIX 120MG FILM TABLET</td>
        <td>NATEGLİNİD</td>
        <td>1</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/Archive/2024/kubKtAttachments/kubtemiz_47e90283-b9cc-4177-a5ac-df13571649be.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>02/2027</td>
        <td>TEGLIX 120MG FILM TABLET</td>
        <td>NATEGLİNİD</td>
        <td>2</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/Archive/2024/kubKtAttachments/kubtemiz_47e90283-b9cc-4177-a5ac-df13571649be.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>11/2026</td>
        <td>TEGLIX 120MG FILM TABLET</td>
        <td>NATEGLİNİD</td>
        <td>4</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/Archive/2024/kubKtAttachments/kubtemiz_47e90283-b9cc-4177-a5ac-df13571649be.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>09/2026</td>
        <td>TEGLIX 120MG FILM TABLET</td>
        <td>NATEGLİNİD</td>
        <td>3</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/Archive/2024/kubKtAttachments/kubtemiz_47e90283-b9cc-4177-a5ac-df13571649be.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>08/2026</td>
        <td>TEGLIX 120MG FILM TABLET</td>
        <td>NATEGLİNİD</td>
        <td>2</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/Archive/2024/kubKtAttachments/kubtemiz_47e90283-b9cc-4177-a5ac-df13571649be.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>07/2026</td>
        <td>TEGLIX 120MG FILM TABLET</td>
        <td>NATEGLİNİD</td>
        <td>1</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/Archive/2024/kubKtAttachments/kubtemiz_47e90283-b9cc-4177-a5ac-df13571649be.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>06/2026</td>
        <td>TEGLIX 120MG FILM TABLET</td>
        <td>NATEGLİNİD</td>
        <td>2</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/Archive/2024/kubKtAttachments/kubtemiz_47e90283-b9cc-4177-a5ac-df13571649be.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>06/2029</td>
        <td>GLİFİX 45 MG TABLET</td>
        <td>PİOGLİTAZON</td>
        <td>3</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/Archive/2019/kubKtAttachments/glifix%2045%20KUB%20YAYIN.pdf_aeaae17a-dba1-47d8-a488-9c1d1056dc3f.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>09/2027</td>
        <td>GLİFİX 45 MG TABLET</td>
        <td>PİOGLİTAZON</td>
        <td>2</td>
        <td>DİYABET</td>
        <td>https://titck.gov.tr/storage/Archive/2019/kubKtAttachments/glifix%2045%20KUB%20YAYIN.pdf_aeaae17a-dba1-47d8-a488-9c1d1056dc3f.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>12/2025</td>
        <td>LERCADİP 10 MG FILM KAPLı TABLET</td>
        <td>LERKANİDİPİN HİDROKLORÜR</td>
        <td>2</td>
        <td>ANTİHİPERTANSİF</td>
        <td>https://titck.gov.tr/storage/Archive/2025/kubKtAttachments/LERCADP10mgKB_20_05_2025.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>10/2026</td>
        <td>LERCADİP 10 MG FILM KAPLı TABLET</td>
        <td>LERKANİDİPİN HİDROKLORÜR</td>
        <td>2</td>
        <td>ANTİHİPERTANSİF</td>
        <td>https://titck.gov.tr/storage/Archive/2025/kubKtAttachments/LERCADP10mgKB_20_05_2025.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>4/2026</td>
        <td>LERCADİP 10 MG FILM KAPLı TABLET</td>
        <td>LERKANİDİPİN HİDROKLORÜR</td>
        <td>3</td>
        <td>ANTİHİPERTANSİF</td>
        <td>https://titck.gov.tr/storage/Archive/2025/kubKtAttachments/LERCADP10mgKB_20_05_2025.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>4/2026</td>
        <td>LERCADİP 20 MG FILM KAPLı TABLET</td>
        <td>LERKANİDİPİN HİDROKLORÜR</td>
        <td>2</td>
        <td>ANTİHİPERTANSİF</td>
        <td>https://titck.gov.tr/storage/Archive/2025/kubKtAttachments/LERCADP20mgKB_20_05_2025.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>09/2027</td>
        <td>BENİPİN 8 MG FİLM TABLET</td>
        <td>BENİDİPİN HİDROKLORÜR</td>
        <td>1</td>
        <td>ANTİHİPERTANSİF</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/f016e08038777.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>07/2027</td>
        <td>BENİPİN 8 MG FİLM TABLET</td>
        <td>BENİDİPİN HİDROKLORÜR</td>
        <td>2</td>
        <td>ANTİHİPERTANSİF</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/f016e08038777.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>04/2027</td>
        <td>CANDEXİL PLUS 32 MG/12.5 MG TABLET</td>
        <td>KANDESARTAN SİLEKSETİL , HİDROKLOROTİYAZİD</td>
        <td>3</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2025/kubKtAttachments/1311kub32125_06_05_2025.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>09/2027</td>
        <td>VASOXEN PLUS 5 MG/12,5 MG FILM KAPLI TABLET</td>
        <td>NEBİVOLOL , HİDROKLOROTİYAZİD</td>
        <td>2</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2022/kubKtAttachments/Vasoxen12.5KB_ba2da51a-5d0b-443f-a0f6-998410e7ed25.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>11/2025</td>
        <td>İRDAPİN 150 MG/5 MG FİLM KAPLI TABLET</td>
        <td>İRBESARTAN , AMLODİPİN</td>
        <td>2</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2025/kubKtAttachments/RDAPN1505KBSON_17_10_2025.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>02/2027</td>
        <td>ZOPROTEC PLUS 30 MG/12,5 MG FILM KAPLI TABLET</td>
        <td>ZOFENOPRİL KALSİYUM , HİDROKLOROTİYAZİD</td>
        <td>4</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2024/kubKtAttachments/kub_9d967c46-f3cd-499b-a5b5-1f9c87a40856.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>12/2027</td>
        <td>CO-İRDA 300 MG / 25 MG FİLM KAPLI TABLET</td>
        <td>İRBESARTAN , HİDROKLOROTİYAZİD</td>
        <td>3</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2025/kubKtAttachments/kub30025_06_08_2025.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>01/2026</td>
        <td>CIBADREX 10/12.5 MG FILM TABLET&quot;&quot;</td>
        <td>BENAZEPRİL HİDROKLORÜR , HİDROKLOROTİYAZİD</td>
        <td>2</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2022/kubKtAttachments/kubtemiz_b5b9f4fb-dd8e-4c65-bb88-ca539191cc97.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>09/2026</td>
        <td>CO-DİOVAN 320/12.5 MG FİLM KAPLI TABLET</td>
        <td>VALSARTAN , HİDROKLOROTİYAZİD</td>
        <td>2</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2025/kubKtAttachments/codiovan32012.5kub_06_08_2025.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>12/2025</td>
        <td>SARILEN PLUS 100 MG/25 MG FILM KAPLI TABLET</td>
        <td>LOSARTAN POTASYUM ,  HİDROKLOROTİYAZİD</td>
        <td>1</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2025/kubKtAttachments/UYGUNKBSARLENPLUS10025_20_05_2025.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>08/2026</td>
        <td>HIPERSAR 20 MG FILM TABLET</td>
        <td>OLMESARTAN MEDOKSOMİL</td>
        <td>1</td>
        <td>ANTİHİPERTANSİF</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/7838f9e088513.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>03/2026</td>
        <td>TRIPLIXAM 10 MG/2.5 MG/10 MG FILM KAPLı TABLET</td>
        <td>PERİNDOPRİL ARJİNİN , HİDROKLOROTİYAZİD , AMLODİPİN</td>
        <td>1</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2023/kubKtAttachments/kb_4661181a-ff11-45db-85d2-1e262f4092ab.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>04/2027</td>
        <td>COVERAM 10MG/10 MG TABLET</td>
        <td>PERİNDOPRİL ARJİNİN , AMLODİPİN</td>
        <td>1</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2023/kubKtAttachments/COVERAM10mg10mgKB_0ba6fa61-aa45-48cb-8154-20089b98dd4f.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>05/2027</td>
        <td>COVERSYL PLUS 5 MG/1.25 MG FİLM KAPLI TABLET</td>
        <td>PERİNDOPRİL ARJİNİN ,  İNDAPAMİD</td>
        <td>1</td>
        <td>ANTİHİPERTANSİF KOMBİNE</td>
        <td>https://titck.gov.tr/storage/Archive/2022/kubKtAttachments/CoversylPlus5mg125mgfilmkapltabletKUB_ac62a587-22d1-4a32-8f4e-7c97e6f3ecfa.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>03/2027</td>
        <td>ALDACTONE-A 25 MG TABLET</td>
        <td>SPİRONOLAKTON</td>
        <td>3</td>
        <td>ANTİHİPERTANSİF</td>
        <td>https://titck.gov.tr/storage/Archive/2022/kubKtAttachments/25kb_1099b408-328c-4e66-ab7d-cec329bcd699.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>02/2026</td>
        <td>ALDACTONE-A 25 MG TABLET</td>
        <td>SPİRONOLAKTON</td>
        <td>2</td>
        <td>ANTİHİPERTANSİF</td>
        <td>https://titck.gov.tr/storage/Archive/2022/kubKtAttachments/25kb_1099b408-328c-4e66-ab7d-cec329bcd699.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>12/2025</td>
        <td>ALDACTONE-A 25 MG TABLET</td>
        <td>SPİRONOLAKTON</td>
        <td>1</td>
        <td>ANTİHİPERTANSİF</td>
        <td>https://titck.gov.tr/storage/Archive/2022/kubKtAttachments/25kb_1099b408-328c-4e66-ab7d-cec329bcd699.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>02/2027</td>
        <td>TENSINOR 100 MG TABLET</td>
        <td>ATENOLOL</td>
        <td>4</td>
        <td>ANTİHİPERTANSİF, ANTİANJİNAL, ANTİARİTMİK</td>
        <td>https://titck.gov.tr/storage/Archive/2025/kubKtAttachments/yaynlanacaktensinor501311kub_04_08_2025.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>06/2026</td>
        <td>MONOKET LONG 50 MG RETARD KAPSÜL</td>
        <td>İSOSORBİT-5-MONONİTRAT</td>
        <td>2</td>
        <td>KORONER ARTER HASTALIĞI, ANTİANJİNAL</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/976678f460204.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>03/2026</td>
        <td>DİGOXİN-ASSOS 0,25 MG TABLET</td>
        <td>DİGOKSİN</td>
        <td>1</td>
        <td>SVT, KALP YETMEZLİĞİ</td>
        <td>https://titck.gov.tr/storage/kubKtAttachments/FigMf3eckYGC9.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>02/2026</td>
        <td>RAZINA 500 MG UZATıLMış SALıMLı TABLET</td>
        <td>RANOLAZİN</td>
        <td>2</td>
        <td>ANTİANJİNAL</td>
        <td>https://titck.gov.tr/storage/Archive/2021/kubKtAttachments/razina500mgkub_37712f2d-0e0b-45be-95d7-60b3a581a056.pdf</td>
        <td></td>
    </tr>
    <tr>
        <td>10/2025</td>
        <td>deneme</td>
        <td>deneme</td>
        <td>1</td>
        <td>deneme</td>
        <td></td>
        <td></td>
    </tbody>
  </table>

  <script>
    const searchInput = document.getElementById("searchInput");
    searchInput.addEventListener("input", () => {
      const term = searchInput.value.trim().toLocaleLowerCase('tr-TR');
      const rows = document.querySelectorAll("#medicineTable tbody tr");
      rows.forEach(row => {
        const text = row.innerText.toLocaleLowerCase('tr-TR');
        row.style.display = (term.length < 3 || text.includes(term)) ? "" : "none";
        if (term.length >= 3) {
          row.innerHTML = row.innerHTML.replace(/<mark>|<\/mark>/g, '');
          row.querySelectorAll("td").forEach(cell => {
            const inner = cell.innerText;
            const regex = new RegExp('(' + term + ')', 'gi');
            cell.innerHTML = inner.replace(regex, "<mark>$1</mark>");
          });
        }
      });
    });
  </script>


<script>
  async function checkLink(el) {
    const url = el.href;
    try {
      const res = await fetch(url, {{ method: 'HEAD' }});
      if (!res.ok) { alert("Uyarı: Bu bağlantı şu anda erişilemez olabilir."); }
    } catch (e) {
      alert("Uyarı: Bu bağlantıya erişilemiyor (internet sorunu veya geçersiz link).");
    }
  }
</script>
</body>

</html>
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>ASM İlaç Takip – Liste Üzerinden Güvenli Düşüm (Canlı Güncellenen)</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f9fbfc; padding: 20px; }
    h1 { color: #2C3E50; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #d5f3d5; }
    button { padding: 5px 10px; margin: 3px; cursor: pointer; }
    .form-section { margin-top: 30px; background: #eef; padding: 15px; border-radius: 8px; display: none; }
    .highlight { background: #d0f0d0; }
  </style>
</head>
<body>

<h1>ASM İlaç Takip Sistemi – Liste Üzerinden Düşüm + Canlı Güncelleme</h1>

<div id="tableContainer">⏳ İlaçlar yükleniyor...</div>

<div id="formSection" class="form-section">
  <h3>Seçilen İlaç: <span id="selectedDrugName"></span></h3>
  <input type="number" id="removeQty" placeholder="Kaç adet düşülecek?" required />
  <input type="text" id="givenTo" placeholder="Verilen Hasta" required />
  <input type="text" id="givenDate" placeholder="Veriliş Tarihi (örn: 29.10.2025)" required />
  <button onclick="confirmAndSubmit()">💊 Stoktan Düş</button>
  <div id="statusMsg"></div>
</div>

<script>
const api = "https://script.google.com/macros/s/AKfycbx7JxLMlY6F08ltji1LEfXD_uumqaxIjq3l4TfrbichvzPD0sFm-Ki3fGw_aCyLhTc/exec";
let selectedRow = null;

async function loadTable() {
  const res = await fetch(api + '?t=' + Date.now());
  const data = await res.json();

  let html = `<table><thead>
    <tr><th>İlaç Adı</th><th>SKT</th><th>Etken Madde</th><th>Stok</th><th>İşlem</th></tr>
  </thead><tbody>`;

  data.forEach((row, index) => {
    if (row["İlaç Adı / Dozaj"] && row["Stok Adedi"]) {
      const rowId = `row${index}`;
      html += `<tr id="${rowId}">
        <td>${row["İlaç Adı / Dozaj"]}</td>
        <td>${row["Son Kullanım Tarihi"]}</td>
        <td>${row["Etken Madde / Dozaj"]}</td>
        <td>${row["Stok Adedi"]}</td>
        <td><button onclick='selectRow(${JSON.stringify(row)}, "${rowId}")'>Stoktan Düş</button></td>
      </tr>`;
    }
  });

  html += "</tbody></table>";
  document.getElementById("tableContainer").innerHTML = html;
}

function selectRow(row, rowId) {
  selectedRow = row;
  document.querySelectorAll("tr").forEach(tr => tr.classList.remove("highlight"));
  document.getElementById(rowId).classList.add("highlight");

  document.getElementById("selectedDrugName").innerText = row["İlaç Adı / Dozaj"] + " / SKT: " + row["Son Kullanım Tarihi"];
  document.getElementById("formSection").style.display = "block";
}

function confirmAndSubmit() {
  if (!selectedRow) return;
  const adet = parseInt(document.getElementById("removeQty").value);
  const hasta = document.getElementById("givenTo").value.trim();
  const tarih = document.getElementById("givenDate").value.trim();

  if (!adet || !hasta || !tarih) {
    alert("Lütfen tüm alanları doldurun.");
    return;
  }

  const kalan = parseInt(selectedRow["Stok Adedi"]) - adet;
  if (kalan < 0) {
    alert("⚠️ Bu kadar stok yok. Lütfen kontrol edin.");
    return;
  }

  const onay = confirm(`${selectedRow["İlaç Adı / Dozaj"]} adlı ilaçtan ${adet} adet düşülecek. Emin misiniz?`);
  if (!onay) return;

  const body = {
    "Son Kullanım Tarihi": selectedRow["Son Kullanım Tarihi"],
    "İlaç Adı / Dozaj": selectedRow["İlaç Adı / Dozaj"],
    "Etken Madde / Dozaj": selectedRow["Etken Madde / Dozaj"],
    "Stok Adedi": kalan,
    "Ana Grup (ASTIM / KOAH vs)": selectedRow["Ana Grup (ASTIM / KOAH vs)"],
    "KÜB / KT Linki": selectedRow["KÜB / KT Linki"],
    "Verilen Tarih": tarih,
    "Verilen Hasta": hasta
  };

  fetch(api, {
    method: "POST",
    body: JSON.stringify(body)
  }).then(r => r.text()).then(msg => {
    document.getElementById("statusMsg").innerText = "✅ " + msg;
    document.getElementById("formSection").style.display = "none";
    loadTable();
  });
}

loadTable();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Abdurrahmanlar ASM İlaç Takip Sistemi – Dinamik</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f7f8; padding: 20px; }
        h1 { color: #2C3E50; }
        form { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 0 5px #ccc; }
        input, select, button { padding: 8px; margin: 5px; width: 90%; }
        button { width: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #d5f3d5; }
        mark { background: yellow; font-weight: bold; }
    </style>
</head>
<body>

<h1>Abdurrahmanlar ASM İlaç Takip Sistemi – Dinamik</h1>

<!-- İlaç Ekleme Formu -->
<form id="addForm">
    <h3>İlaç Ekle</h3>
    <input required name="Son Kullanım Tarihi" placeholder="Son Kullanım Tarihi (Örn: 12.2026)" />
    <input required name="İlaç Adı / Dozaj" placeholder="İlaç Adı / Dozaj" />
    <input required name="Etken Madde / Dozaj" placeholder="Etken Madde / Dozaj" />
    <input required type="number" name="Stok Adedi" placeholder="Stok Adedi" />
    <input name="Ana Grup (ASTIM / KOAH vs)" placeholder="Ana Grup (opsiyonel)" />
    <input name="KÜB / KT Linki" placeholder="KÜB / KT Linki (opsiyonel)" />
    <button type="submit">Ekle</button>
    <div id="addMsg"></div>
</form>

<!-- Stoktan Düşme Formu -->
<form id="removeForm">
    <h3>İlaç Çıkışı (Stoktan Düş)</h3>
    <input required id="searchName" placeholder="İlaç adı (örn: Coversyl)" />
    <select required id="dateSelect"></select>
    <input required type="number" id="removeQty" placeholder="Kaç adet düşülecek?" />
    <input required id="givenTo" placeholder="Verilen Hasta" />
    <input required id="givenDate" placeholder="Veriliş Tarihi (örn: 29.10.2025)" />
    <button type="submit">Stoktan Düş</button>
    <div id="removeMsg"></div>
</form>

<!-- Mevcut Stok Görüntüleme -->
<table id="stockTable">
    <thead>
        <tr>
            <th>Son Kullanım Tarihi</th>
            <th>İlaç Adı</th>
            <th>Etken Madde</th>
            <th>Stok Adedi</th>
            <th>Grup</th>
            <th>KÜB/KT</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
const api = "https://script.google.com/macros/s/AKfycbx7JxLMlY6F08ltji1LEfXD_uumqaxIjq3l4TfrbichvzPD0sFm-Ki3fGw_aCyLhTc/exec";

// İlaç ekleme
document.getElementById('addForm').onsubmit = async (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target).entries());
    data["Verilen Tarih"] = "";
    data["Verilen Hasta"] = "";
    const res = await fetch(api, {
        method: "POST",
        body: JSON.stringify(data)
    });
    document.getElementById("addMsg").innerText = await res.text();
    e.target.reset();
    loadStock();
};

// Stok görüntüleme
async function loadStock() {
    const res = await fetch(api);
    const data = await res.json();
    const tbody = document.querySelector("#stockTable tbody");
    tbody.innerHTML = "";
    data.forEach(row => {
        if (row["İlaç Adı / Dozaj"] && row["Stok Adedi"]) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${row["Son Kullanım Tarihi"]}</td>
                <td>${row["İlaç Adı / Dozaj"]}</td>
                <td>${row["Etken Madde / Dozaj"]}</td>
                <td>${row["Stok Adedi"]}</td>
                <td>${row["Ana Grup (ASTIM / KOAH vs)"]}</td>
                <td><a href="${row["KÜB / KT Linki"]}" target="_blank">Link</a></td>
            `;
            tbody.appendChild(tr);
        }
    });
}

// Aramaya göre tarihler getir
document.getElementById("searchName").oninput = async (e) => {
    const name = e.target.value.trim().toLowerCase();
    const res = await fetch(api);
    const data = await res.json();
    const select = document.getElementById("dateSelect");
    select.innerHTML = "";
    const filtered = data.filter(row => row["İlaç Adı / Dozaj"]?.toLowerCase().includes(name));
    filtered.forEach(row => {
        const option = document.createElement("option");
        option.value = JSON.stringify(row);
        option.innerText = `${row["Son Kullanım Tarihi"]} — ${row["Stok Adedi"]} adet`;
        select.appendChild(option);
    });
};

// Stok düşme
document.getElementById("removeForm").onsubmit = async (e) => {
    e.preventDefault();
    const selectedRow = JSON.parse(document.getElementById("dateSelect").value);
    const removeQty = parseInt(document.getElementById("removeQty").value);
    const kalan = parseInt(selectedRow["Stok Adedi"]) - removeQty;
    const body = {
        "Son Kullanım Tarihi": selectedRow["Son Kullanım Tarihi"],
        "İlaç Adı / Dozaj": selectedRow["İlaç Adı / Dozaj"],
        "Etken Madde / Dozaj": selectedRow["Etken Madde / Dozaj"],
        "Stok Adedi": kalan,
        "Ana Grup (ASTIM / KOAH vs)": selectedRow["Ana Grup (ASTIM / KOAH vs)"],
        "KÜB / KT Linki": selectedRow["KÜB / KT Linki"],
        "Verilen Tarih": document.getElementById("givenDate").value,
        "Verilen Hasta": document.getElementById("givenTo").value
    };
    const res = await fetch(api, { method: "POST", body: JSON.stringify(body) });
    document.getElementById("removeMsg").innerText = await res.text();
    e.target.reset();
    loadStock();
};

loadStock();
</script>

</body>
</html>
